<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Writing an (Overly) Idiomatic Fizzbuzz with Rust | Fotonix &amp; Gizmos</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://www.fotonixx.com/posts/rust-fizzbuzz/">
<link rel="icon" href="../../favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Ryan Frazier">
<link rel="prev" href="../data-science-vcs/" title="Version Controlling Your Data Science Projects" type="text/html">
<meta property="og:site_name" content="Fotonix &amp; Gizmos">
<meta property="og:title" content="Writing an (Overly) Idiomatic Fizzbuzz with Rust">
<meta property="og:url" content="https://www.fotonixx.com/posts/rust-fizzbuzz/">
<meta property="og:description" content="The last couple few months have been a whirlwind exposure to Rust. It started when I was looking for a systems language to speed up pieces of PyRayT that was more general than Cython, but not C/C++ (w">
<meta property="og:image" content="https://www.fotonixx.com/images/rust_fizzbuzz/preview_image.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-07-08T20:27:33-04:00">
<meta property="article:tag" content="rust">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">
            <img src="../../images/site_logo.svg" alt="Fotonix &amp; Gizmos" id="logo" class="d-inline-block align-top"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../projects/" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../about/" class="nav-link">About</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        

<article class="post-text h-entry hentry postpage " itemscope="itemscope" itemtype="http://schema.org/Article"><div class="row">
        <div class="col-lg-8 col-md-12">
                <header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Writing an (Overly) Idiomatic Fizzbuzz with Rust</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Ryan Frazier
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-07-08T20:27:33-04:00" itemprop="datePublished" title="2021-07-08 20:27">2021-07-08 20:27</time></a>
            </p>
            
        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
            <div>
<p>The last couple few months have been a whirlwind exposure to <a class="reference external" href="https://www.rust-lang.org/">Rust</a>. It started when I was looking for a systems language to speed up pieces of <a class="reference external" href="https://pyrayt.readthedocs.io">PyRayT</a> that was more general than <a class="reference external" href="https://cython.org/">Cython</a>, but not C/C++ (which I have my own love/hate relationship with). After reading the excellently written <a class="reference external" href="https://doc.rust-lang.org/book/">Rust Book</a> I was hooked on the language, using it for a couple CLIs, a <a class="reference external" href="https://github.com/rfrazier716/mongo_warp">webserver</a>, and even going through old <a class="reference external" href="https://adventofcode.com/">Advent of Code</a> puzzles to get more practice.</p>
<div class="figure align-center">
<img alt="https://i.imgflip.com/5fy2ea.jpg" src="https://i.imgflip.com/5fy2ea.jpg" style="width: 500px;"><p class="caption">This is slowly becoming my answer to all things software related</p>
</div>
<p>This post isn't going to be a gushing review of Rust (though as <a class="reference external" href="https://insights.stackoverflow.com/survey/2020#technology-most-loved-dreaded-and-wanted-languages-loved">2020's most loved language</a> you won't be hard pressed to find one of those either). Instead, it's sparked from an article I saw on <a class="reference external" href="https://this-week-in-rust.org/">This Week in Rust</a> back in June about writing an <a class="reference external" href="https://shane-o.dev/blog/binary-search-rust">idiomatic binary search</a>. The binary search is a well known algorithm, which got me thinking: what's another well known program I could use to practice writing idiomatic code? The answer: <a class="reference external" href="https://en.wikipedia.org/wiki/Fizz_buzz">Fizzbuzz</a>, the programming puzzle commonly used in interviews to make sure the candidate actually knows what a for loop is.</p>
<p>In this post I'll be starting with a standard Fizzbuzz solution, and polishing it up to take full advantage of all the features and programming style Rust offers.</p>
<div class="contents alert alert-primary ml-0 topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-makes-code-idiomatic" id="id1">What Makes Code Idiomatic?</a></p></li>
<li>
<p><a class="reference internal" href="#the-basic-fizzbuzz" id="id2">The Basic Fizzbuzz</a></p>
<ul>
<li><p><a class="reference internal" href="#make-me-a-match" id="id3">Make Me a Match</a></p></li>
</ul>
</li>
<li>
<p><a class="reference internal" href="#getting-idiomatic" id="id4">Getting Idiomatic</a></p>
<ul>
<li><p><a class="reference internal" href="#idiomatic-testing" id="id5">Idiomatic Testing???</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#generic-traits-and-monomorphization" id="id6">Generic Traits and Monomorphization</a></p></li>
<li><p><a class="reference internal" href="#going-off-the-deep-end" id="id7">Going off the Deep End</a></p></li>
</ul>
</div>
<div class="contents alert alert-primary ml-0 topic" id="quick-links">
<p class="topic-title">Quick Links</p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-makes-code-idiomatic" id="id8">What Makes Code Idiomatic?</a></p></li>
<li>
<p><a class="reference internal" href="#the-basic-fizzbuzz" id="id9">The Basic Fizzbuzz</a></p>
<ul>
<li><p><a class="reference internal" href="#make-me-a-match" id="id10">Make Me a Match</a></p></li>
</ul>
</li>
<li>
<p><a class="reference internal" href="#getting-idiomatic" id="id11">Getting Idiomatic</a></p>
<ul>
<li><p><a class="reference internal" href="#idiomatic-testing" id="id12">Idiomatic Testing???</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#generic-traits-and-monomorphization" id="id13">Generic Traits and Monomorphization</a></p></li>
<li><p><a class="reference internal" href="#going-off-the-deep-end" id="id14">Going off the Deep End</a></p></li>
</ul>
</div>
<div class="section" id="what-makes-code-idiomatic">
<h2><a class="toc-backref" href="#id8">What Makes Code Idiomatic?</a></h2>
<p>Before diving into the <em>how</em>, it's worth covering <em>what</em> idiomatic code actually is. Outside of coding context, idiomatic means "using, containing, or denoting expressions that are natural to a native speaker." When discussing idiomatic programming, it means the program leverages features unique to the language to accomplish the task. Coming from <a class="reference external" href="https://www.python.org/">Python</a>, I would hear this as writing "Pythonic" code (list comprehension, generators, etc.).</p>
<p>Idiomatic Rust should leverage Rust's unique features such as match, traits, iterators, and ownership. Since I'm still learning Rust every day, I use the linter <a class="reference external" href="https://github.com/rust-lang/rust-clippy">Clippy</a>, to catch common mistakes and recommend idiomatic alternatives!</p>
</div>
<div class="section" id="the-basic-fizzbuzz">
<h2><a class="toc-backref" href="#id9">The Basic Fizzbuzz</a></h2>
<p>The goal of Fizzbuzz is simple:</p>
<ul class="simple">
<li><p>Write a short program that prints each number from 1 to 100 on a new line.</p></li>
<li><p>For each multiple of 3, print "Fizz" instead of the number.</p></li>
<li><p>For each multiple of 5, print "Buzz" instead of the number.</p></li>
<li><p>For numbers which are multiples of both 3 and 5, print "FizzBuzz" instead of the number.</p></li>
</ul>
<p>The first bullet screams "for loop" while the next three are conditional (if) statements. With that in mind we'll write our simplest solution relying on a series of if-else statements and the modulo operator.</p>
<div class="rust-playground">
    <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=4ab45aafc8a95c02010f84f66aabdaaf">
        <i class="fas fa-play"></i> Run on the Rust Playground
    </a>
</div>
<pre class="code rust"><a name="rest_code_bc21af91251349dc910d47261b75a6af-1"></a><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-4"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"FizzBuzz"</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-5"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-6"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Fizz"</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-7"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-8"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Buzz"</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-10"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-11"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-12"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_bc21af91251349dc910d47261b75a6af-13"></a><span class="p">}</span><span class="w"></span>
</pre>
<p>This gets us the desired output, but there's nothing idiomatic about it. With the exception of <code>..=</code> (specifies a range "up to and including"), none of Rust's unique features are being used. In fact, it looks almost identical to a solution written in Python! Clearly we can do better.</p>
<div class="section" id="make-me-a-match">
<h3><a class="toc-backref" href="#id10">Make Me a Match</a></h3>
<p>If you haven't read <a class="reference external" href="https://doc.rust-lang.org/book/">Rust Book</a>, bookmark it right away! It's one of the best introductions to a language I've ever read, and explains not just the core language, but the toolchains surrounding it that make Rust so accessible. One thing the book wastes no time introducing is Rust's <code>match</code> operator:</p>
<blockquote>
<p>"Rust has an extremely powerful control flow operator called match that allows you to compare a value against a series of patterns and then execute code based on which pattern matches. Patterns can be made up of literal values, variable names, wildcards, and many other things"</p>
<p class="attribution">—<a class="reference external" href="https://doc.rust-lang.org/book/ch06-02-match.html">The Rust Book Ch. 6-2</a></p>
</blockquote>
<p>Let's update our basic function to use <code>match</code> instead of <code>if-else</code>. We want to match the output of two modulo operators, if they're both zero we'll output <code>Fizzbuzz</code>, if only one is zero we'll output <code>Fizz</code> or <code>Buzz</code> depending on the zero. and if neither are zero we'll simply output the number.</p>
<div class="rust-playground">
    <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=49150dcded25e25489d34dae9cfad0a3">
        <i class="fas fa-play"></i> Run on the Rust Playground
    </a>
</div>
<pre class="code rust"><a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-1"></a><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-3"></a><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-4"></a><span class="w">            </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"FizzBuzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-5"></a><span class="w">            </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Fizz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-6"></a><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Buzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-7"></a><span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-8"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-9"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_7ca8da833b204257aaf97c77d004f6ae-10"></a><span class="p">}</span><span class="w"></span>
</pre>
<p>Now this is starting to look more like Rust! By using <code>match</code> we're able to eliminate a lot of unnecessary brackets and only have to calculate the modulo once, instead of at every if statement. Since the <code>match</code> control flow operates from top to bottom, we need the "FizzBuzz" case to be listed first, as both "Fizz" and "Buzz" also satisfy the <code>(0,0)</code> case.</p>
</div>
</div>
<div class="section" id="getting-idiomatic">
<h2><a class="toc-backref" href="#id11">Getting Idiomatic</a></h2>
<p>The above code would be more than enough to show an interviewer you passed CS 100, but we want to squeeze every possible idiomatic opportunity out of this function, so our next step will be pulling our logic out of the main function and into a trait. Again referencing the Rust Book:</p>
<blockquote>
<p>"A trait tells the Rust compiler about functionality a particular type has and can share with other types. We can use traits to define shared behavior in an abstract way. We can use trait bounds to specify that a generic can be any type that has certain behavior."</p>
<p class="attribution">—<a class="reference external" href="https://doc.rust-lang.org/book/ch10-02-traits.html">The Rust Book Ch. 10-2</a></p>
</blockquote>
<p>Right now we're only going to focus one one small feature of traits: defining sets of methods that can be called on a type (in our case <code>i32</code>). Our trait <code>Fizzy</code> will be simple in that it only has one function (also named <code>fizzy</code>) that accepts a reference to the number and returns a String based on our Fizzbuzz rules.</p>
<pre class="code rust"><a name="rest_code_041c4126cba64c9295b109a805cc8d55-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Fizzy</span><span class="p">{</span><span class="w"></span>
<a name="rest_code_041c4126cba64c9295b109a805cc8d55-2"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span><span class="p">;</span><span class="w"></span>
<a name="rest_code_041c4126cba64c9295b109a805cc8d55-3"></a><span class="p">}</span><span class="w"></span>
</pre>
<p>Trait definitions only declare the methods, they do not define the actual logic. For that we need to <em>implement</em> the trait for our selected type. This is as easy as making an <code>impl</code> for <code>i32</code> and moving the match statement out of our main function into the <code>fizzy</code> method. Our new program is shown below with the logic separated out into its own trait.</p>
<div class="rust-playground">
    <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b2f1e2702441ebb90ededd28ae91959d">
        <i class="fas fa-play"></i> Run on the Rust Playground
    </a>
</div>
<pre class="code rust"><a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Fizzy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-2"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span><span class="p">;</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-3"></a><span class="p">}</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-4"></a>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-5"></a><span class="k">impl</span><span class="w"> </span><span class="n">Fizzy</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-6"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-7"></a><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-8"></a><span class="w">            </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"FizzBuzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-9"></a><span class="w">            </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"Fizz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-10"></a><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"Buzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-11"></a><span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-12"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-13"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-14"></a><span class="p">}</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-15"></a>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-16"></a><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-18"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">())</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-19"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_4d4dd2ee70274d28bbc6aa43645e97ce-20"></a><span class="p">}</span><span class="w"></span>
</pre>
<p>It may look like all we did was shuffle around where the code was (and for this simple of a program traits are already overkill) but structuring our logic into a trait allows for flexibility down the road, especially if we have to add more methods to <code>Fizzy</code> or define it for different types (imagine a new Fizzbuzz with letters instead of numbers). The separation also allows us to write unit tests to validate <code>fizzy</code> since it can be called separately from the main function.</p>
<div class="section" id="idiomatic-testing">
<h3><a class="toc-backref" href="#id12">Idiomatic Testing???</a></h3>
<p>Unit tests themselves are not particularly idiomatic to Rust. In fact, you'd be hard pressed to find a modern language that does not have an extensive unit test framework to tap into. What <em>is</em> idiomatic, however, is how testing is built into the core language and Rust's solution to testing private interfaces.</p>
<p>When writing a class/interface, I'll split complex methods into multiple small methods that can be easily tested, but I don't want those interim methods exposed to the end user. Python makes this easy enough with private methods, prefixing a function with an underscore (_) marks it as private, and most documentation and linters will treat it as such. However, it's actually as public as any other function, so while the IDE might flag a warning when I call the method to test it, there's nothing illegal about doing so (see below).</p>
<pre class="code Python"><a name="rest_code_f18bc4381136455c9a38308e5ba495b1-1"></a><span class="k">class</span> <span class="nc">Greeter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-2"></a>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-5"></a>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-6"></a>    <span class="c1"># putting an _ before a method marks it as private</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-7"></a>    <span class="k">def</span> <span class="nf">_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preamble</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-8"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">preamble</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-9"></a>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-10"></a>    <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">)</span> <span class="c1"># a public interface can call a private method</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-12"></a>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-13"></a>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-14"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-15"></a>    <span class="n">greeter</span> <span class="o">=</span> <span class="n">Greeter</span><span class="p">(</span><span class="s2">"Fotonix"</span><span class="p">)</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-16"></a>    <span class="n">greeter</span><span class="o">.</span><span class="n">hello</span><span class="p">()</span> <span class="c1"># this instance method is public</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-17"></a>    <span class="n">greeter</span><span class="o">.</span><span class="n">_address</span><span class="p">(</span><span class="s2">"Buongiorno"</span><span class="p">)</span> <span class="c1"># this method is private, but can still be called</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-18"></a>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-19"></a><span class="c1">#-- Output --</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-20"></a><span class="c1"># Hello Fotonix</span>
<a name="rest_code_f18bc4381136455c9a38308e5ba495b1-21"></a><span class="c1"># Buongiorno Fotonix</span>
</pre>
<p>On the opposite side of the accessability spectrum we have C++, which uses its <a class="reference external" href="https://stackoverflow.com/questions/860339/difference-between-private-public-and-protected-inheritance">public, private, and protected</a> keywords to strictly enforce what objects and classes have access to those methods. While this is great from a security standpoint, it makes testing non-public interfaces difficult because you either have to (1) accept that you can only write "blackbox tests" that test the interfaces end users have, or (2) create <a class="reference external" href="https://www.geeksforgeeks.org/friend-class-function-cpp/">friend classes</a> that wrap the private functions in a public interface, and test that new interface.</p>
<p>Rust strikes a happy medium between the two. You can still declare traits as public or private, and that privacy is not only respected, but enforced at compile-time. However, using the <a class="reference external" href="https://doc.rust-lang.org/book/ch07-02-defining-modules-to-control-scope-and-privacy.html">modules</a> system, you can put your tests in a path that has access to the private traits (i.e. they're within the trait's scope).</p>
<p>The most common way to do this is to <em>inline unit tests in the same file as the methods you're testing</em> and wrapping them in a module called <code>test</code>. Apart from this unique layout, writing the tests themselves is similar to most unit-test frameworks. Rust has built-in macros for assertions and tests can be separated into functions to run concurrently. We'll add unit-tests to the bottom of our Fizzbuzz program to validate the <code>Fizzy</code> trait. Tests can by run by running <code>cargo test</code> from the terminal, or "test" from the pull-down menu in the playground.</p>
<div class="rust-playground">
    <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0903c09a16ab46e0fbc66beb3129280e">
        <i class="fas fa-play"></i> Run on the Rust Playground
    </a>
</div>
<pre class="code rust"><a name="rest_code_44397b6a60284e6d8a88749647a9bd26-1"></a><span class="cp">#[cfg(test)]</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-2"></a><span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-3"></a><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">super</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-4"></a>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-5"></a><span class="w">    </span><span class="cp">#[test]</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-6"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">test_fizz</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-7"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-8"></a><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">(),</span><span class="w"> </span><span class="s">"Fizz"</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-9"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-10"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-11"></a>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-12"></a><span class="w">    </span><span class="cp">#[test]</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-13"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">test_buzz</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-14"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-15"></a><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">(),</span><span class="w"> </span><span class="s">"Buzz"</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-16"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-17"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-18"></a>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-19"></a><span class="w">    </span><span class="cp">#[test]</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-20"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">test_fizzbuzz</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-21"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-22"></a><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">(),</span><span class="w"> </span><span class="s">"FizzBuzz"</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-23"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-24"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-25"></a>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-26"></a><span class="w">    </span><span class="cp">#[test]</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-27"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">test_num</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-28"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="mi">98</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-29"></a><span class="w">            </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">(),</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-30"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-31"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_44397b6a60284e6d8a88749647a9bd26-32"></a><span class="p">}</span><span class="w"></span>
</pre>
</div>
</div>
<div class="section" id="generic-traits-and-monomorphization">
<h2><a class="toc-backref" href="#id13">Generic Traits and Monomorphization</a></h2>
<p>At this point pulling out the above Fizzbuzz will knock any interviewer's socks clean off... or they'll be annoyed that you've spend so much time on such an easy question, could go either way. But we're not here to please an imaginary interviewer! We're writing the most idiomatic Fizzbuzz in the history of Rust, so let's add one more "<em>totally unnecessary in this context but useful in general</em>" feature: Generic Types.</p>
<p>Up until now we've used <code>i32</code> as the base type for all things Fizzbuzz. It's a safe bet for general integers, having a range of &gt;4 billion, but will it always be the <em>right</em> choice for our program? If Fizzbuzz will only ever use positive numbers, you may as well use an unsigned int. If you only ever need to calculate up to 100, 32-bits is overkill and you're better off with <code>u8</code>. Instead of trying to predict the end use-case, we want to write our trait implementation such that the main function can call it with <em>any</em> integer type, and an appropriate trait method is called.</p>
<p>Rust solves this issue with <a class="reference external" href="https://doc.rust-lang.org/book/ch10-01-syntax.html">generics</a>. Instead of defining a function for a specific type, the programmer defines a set of traits that the type <strong>must</strong> implement. Generics are one of Rust's <em>zero-cost abstractions</em>, and provide flexibility while incurring <a class="reference external" href="https://doc.rust-lang.org/book/ch10-01-syntax.html#performance-of-code-using-generics">no overhead at runtime</a>.</p>
<p>To make <code>Fizzy</code> generic to all int types, we'll use the <a class="reference external" href="https://crates.io/crates/num">num</a> crate. The trait we want is <code>PrimInt</code> which is a general abstraction for integer types, and <code>Zero</code> which will generate the zero value we compare to. We also need the <code>Display</code> trait from the standard library, which enforces that the type can be formatted into a string.</p>
<div class="rust-playground">
    <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8305e2bdd08c0da94542fc3a8d670a7c">
        <i class="fas fa-play"></i> Run on the Rust Playground
    </a>
</div>
<pre class="code rust"><a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-1"></a><span class="k">use</span><span class="w"> </span><span class="n">num_traits</span>::<span class="p">{</span><span class="n">identities</span>::<span class="n">Zero</span><span class="p">,</span><span class="w"> </span><span class="n">PrimInt</span><span class="p">};</span><span class="w"> </span><span class="c1">// 0.2.14</span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-2"></a>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-3"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Fizzy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-4"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span><span class="p">;</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-5"></a><span class="p">}</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-6"></a>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-7"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Fizzy</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-8"></a><span class="k">where</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-9"></a><span class="w">    </span><span class="n">T</span>: <span class="nc">PrimInt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Zero</span><span class="p">,</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-10"></a><span class="w">    </span><span class="n">T</span>: <span class="nc">std</span>::<span class="n">fmt</span>::<span class="n">Display</span><span class="p">,</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-11"></a><span class="p">{</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-12"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-13"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">zero</span><span class="p">();</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-14"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">from</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// These will never fail</span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-15"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">five</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">from</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-16"></a><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">three</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">five</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-17"></a><span class="w">            </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"FizzBuzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-18"></a><span class="w">            </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"Fizz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-19"></a><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"Buzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-20"></a><span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-21"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-22"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-23"></a><span class="p">}</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-24"></a>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-25"></a><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-26"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-27"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">())</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-28"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_34f99b4542f24d4fbb88c1e2c34df554-29"></a><span class="p">}</span><span class="w"></span>
</pre>
<p>Notice how we can no longer use integers in <code>fizzy</code>, but instead have to convert them to our generic type within the function. Fortunately the compiler optimizes this out and replaces them with constants in the final code. This is also a case where its acceptable to use <code>unwrap</code> without fear of causing a panic at runtime. Since T implements <code>PrimInt</code> we know a conversion from integers to T will never fail.</p>
</div>
<div class="section" id="going-off-the-deep-end">
<h2><a class="toc-backref" href="#id14">Going off the Deep End</a></h2>
<p>We did it, we wrote an amazing Fizzbuzz leveraging a slew of Rust's unique features! But we also cheated slightly... The rules of the game asked us to print the result of the fizzbuzz check, but to enable testing we return a <code>String</code> that's printed in the main loop. We can trim down this waste of a <em>whopping 72 bytes</em> of memory by having <code>fizzy</code> write directly to an IO stream! The easiest solution would be to have our function call the <code>println!</code> macro directly, but then we can no longer test our function. Instead, We'll borrow a tip from the <a class="reference external" href="https://rust-cli.github.io/book/tutorial/testing.html#making-your-code-testable">Rust CLI Book</a> (different than <em>The Rust Book</em>, but equally as good) where we pass a mutable reference to a <code>Writer</code> handle. In the main loop that handle will point to stdout, but for testing it will be a <code>vector</code> that we can compare to the expected output.</p>
<p>This requires a couple modifications to our <code>fizzy</code> function:</p>
<ol class="arabic simple">
<li><p>We need to replace all the match statement arms with <code>writeln!</code> macro calls.</p></li>
<li><p>Since <code>writeln!</code> can fail we need to modify the signature of <code>fizzy</code> to return a <code>std::io::Result</code> enum, allowing us to squeeze in yet another idiomatic feature: Error Types!</p></li>
</ol>
<p>We also want to be able to catch the error in the main function. so we'll replace the for loop with an iterator, and consume it with a <code>try_for_each</code> method.</p>
<div class="rust-playground">
    <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=df1f2f10f63bc1eed011574e4ce5ba31">
        <i class="fas fa-play"></i> Run on the Rust Playground
    </a>
</div>
<pre class="code rust"><a name="rest_code_b6b024b103bd44c08debafb382a56717-1"></a><span class="k">use</span><span class="w"> </span><span class="n">num_traits</span>::<span class="p">{</span><span class="n">identities</span>::<span class="n">Zero</span><span class="p">,</span><span class="w"> </span><span class="n">PrimInt</span><span class="p">};</span><span class="w"> </span><span class="c1">// 0.2.14</span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="p">{</span><span class="nb">Result</span><span class="p">,</span><span class="w"> </span><span class="n">Write</span><span class="p">};</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-3"></a>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-4"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Fizzy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-5"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">writer</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Write</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-6"></a><span class="p">}</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-7"></a>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-8"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Fizzy</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-9"></a><span class="k">where</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-10"></a><span class="w">    </span><span class="n">T</span>: <span class="nc">PrimInt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Zero</span><span class="p">,</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-11"></a><span class="w">    </span><span class="n">T</span>: <span class="nc">std</span>::<span class="n">fmt</span>::<span class="n">Display</span><span class="p">,</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-12"></a><span class="p">{</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-13"></a><span class="w">    </span><span class="k">fn</span> <span class="nf">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">writer</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Write</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-14"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">zero</span><span class="p">();</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-15"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">from</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// These will never fail</span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-16"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">five</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">from</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-17"></a><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">three</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">five</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-18"></a><span class="w">            </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="s">"FizzBuzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-19"></a><span class="w">            </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="s">"Fizz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-20"></a><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="s">"Buzz"</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-21"></a><span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">),</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-22"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-23"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-24"></a><span class="p">}</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-25"></a>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-26"></a><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-27"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">stdout</span><span class="p">();</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="p">).</span><span class="n">try_for_each</span><span class="p">(</span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">fizzy</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">out</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-29"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"IO Error Writing to Stream: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-30"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a name="rest_code_b6b024b103bd44c08debafb382a56717-31"></a><span class="p">}</span><span class="w"></span>
</pre>
<p>With those small changes we've added mutable references, iterators, and error handling to the list of features this little program can demonstrate. Was any of it necessary? Not at all! Our final output is no different than the first program composed of if-else statements. But it's always fun to start with a trivial program and think up ways to transform it into something that makes me feel like I'll one day earn the title of "Rustacean".</p>
</div>
</div>
            </div>
                    <ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/rust/" rel="tag">rust</a></li>
        </ul>
</div>

        <div class="col-lg-4 col-md-12">
                <div class="sticky-top" id="sticky-right" style="top: 1.5rem">
        <div class="mx-2" id="quick-nav"></div>
        <div class="addthis_inline_share_toolbox mx-auto"></div>
    </div>

    <script>
        document.getElementById('quick-nav').appendChild(
        document.getElementById('quick-links')
        );
    </script>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../data-science-vcs/" rel="prev" title="Version Controlling Your Data Science Projects">Previous post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            
Contents © 2021         <a href="mailto:ryan@fotonixx.com">Ryan Frazier</a> 
- Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         

<span class="follow-icons">

  <a href="mailto:rfrazier716+site@gmail.com" class="fas fa-envelope-square fa-2x follow-icon"></a>
  <a href="https://github.com/rfrazier716" class="fab fa-github-square fa-2x follow-icon"></a>
  <a href="https://www.instagram.com/fotonix716/" class="fab fa-instagram-square fa-2x follow-icon"></a>
  <a href="https://twitter.com/FotonixAndGizmo" class="fab fa-twitter-square fa-2x follow-icon"></a>
</span>

            
        </footer>
</div>
</div>

        <script src="../../assets/js/all-nocdn.js"></script><script src="https://kit.fontawesome.com/b9c0b6e7c8.js" crossorigin="anonymous"></script><!-- Go to www.addthis.com/dashboard to customize your tools --><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-603c029f21971de0"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
