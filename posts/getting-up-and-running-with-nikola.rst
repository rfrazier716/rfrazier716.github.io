.. title: Getting Up and Running with Nikola
.. slug: getting-up-and-running-with-nikola
.. date: 2021-03-01 16:43:38 UTC-05:00
.. tags: 
.. category: Programming
.. link: 
.. description: 
.. type: text
.. status: draft


I have absolutely no background in web development or design. That's probably as good of a disclosure as any when writing a post about deploying a website. However, on almost Every Nikola based blog I looked at the first post was something akin to "Here's how I set up my blog with Nikola",' and who am I to mess with an apparent Tradition! 


Why Nikola? 
------------

Put simply: I like learning new things and Nikola was a way to dip my toe into making a website that was somewhere between using an online suite and hand-writing HTML. I know I could have started a blog on Wordpress or Medium, abstracted away all the details, and potentially have had a prettier site in less time, but where's the fun in that! the fact that Nikola was based around python and .rst files was also attractive. I'm a big advocate for Python, it's become my go-to programming language at work (previously it was Mathematica as well as a lot of LabView but that's a topic for a different day) and anywhere I can use it to round out my programming capabilities I'm happy to give it a try.


.. image:: /images/using_nikola/use_python.jpg
   :width: 500
   :align: center
   :alt: My answer to most programming questions at work



At work I maintain a data analysis library for our group, which includes writing and hosting documentation on our internal GitLab, so I was already familiar with .rst files. In fact, Nikola feels like an extension of using Sphinx but with more control over the structure over the final site. 


Tips to Get Started 
-------------------------

The getting started page for Nikola is a great resource. I'm sure had I read it in more detail I would have spotted some of these errors earlier, but I was too excited to see that homepage and add some customization. That being said, below are a couple of snags I ran into, as well as how to resolve them. 

A virtual environment Helps, but an environment manager is probably overkill
  Most of my Python projects start with the same three steps: (1) initialize a new github repository (2) create a project directory, and (3) initialize a new pipenv or poetry environment. This site was no exception, but now that I'm looking at the pyproject.toml and poetry.lock file in the root directory I'm realizing the dependency resolution was overkill. There's a grand total of one package in my pyproject dependencies (well two, I installed tox as a dev dependency... again out of habit), so I'll likely delete those and stick to a plain old virtualenv.


The Nav Bar needs to have absolute paths
  Almost immediately after building the site and opening it in a browser, I wanted to customize the navigation bar links at the top of the page. Nikola's documentation has a section for this, but something that wasn't listed is that any internal links need to be start with a '/' or they'll be handled as relative links to whatever page you're on. This resulted in my links working from the homepage, but if I navigated to a different page the they would break. 
  
  In retrospect this is pretty obvious, but it still tripped me up for a solid 20 minutes more than necessary.

  .. code-block:: python
    
    NAVIGATION_LINKS = {
        DEFAULT_LANG: (
            ('/', 'Home'),
            ('/pages/projects/', "Projects"),
            ((
                ("/archive.html", "All"),
                ("/categories/cat_programming/", "Programming"),
                ("/categories/cat_gaming/", "Video Games"),
                ("/categories/cat_misc/", "Misc"),
            ),
            "Blog"),
            ('/pages/about', "About"),
            ("/categories/", "Tags"),
        ),
    }

You can hide the "source" link that shows up in the top right of your pages
  By default each page and blog post will have a hyperlink to the source in the top right corner. Since the site is hosted from a public repository and anybody who wants to can look at the source, I wanted to disable that feature. Turns out it's also an option in the conf.py called ``SHOW_SOURCELINK``, and needs to be set to False.

  .. code-block:: python

    # Show link to source for the posts?
    SHOW_SOURCELINK = False
    # Copy the source files for your pages?
    # Setting it to False implies SHOW_SOURCELINK = False
    COPY_SOURCES = False

You're Allowed to Add Build Directories To Your .gitignore
  This is not Nikola specific but more about deploying pages with Nikola and GitHub pages. My thought process was "well the site will be deployed on github, so I guess I need to include all the build files in version control. This was a mental clash with everything I'd been taught about git, specifically that any autogenerated code should be added to your .gitignore file. Turns out Nikola already handles this with the github deploy commands (again configurable in the conf.py). I haven't dug into exactly what's happening under the hood, but my guess is it's creating a git subtree from the output directory, and pushing that newly created subtree branch to github. This let me use the .gitignore like I was used to, since all the build code exists in its own branch.

  The handbook says that you need to set your deploy branch to 'Master' in for user pages, but it works with any branch name as long as you update the publishing source accordingly in the repository settings. For my repository I use a branch called 'deploy' which lets me keep my source code in the protected 'main' branch.